<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="styles.css" />
	<title>Проект "Комменты"</title>
</head>

<body>
	<div class="container">
		<ul class="comments" id="list">
		</ul>
		<div class="add-form">
			<input type="text" class="add-form-name" placeholder="Введите ваше имя" value="" />
			<textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4">
			</textarea>
			<div class="add-form-row">
				<button class="add-form-button">Написать</button>
			</div>
		</div>
	</div>
</body>
<script>
	"use strict";
	// Код писать здесь
	const btnElement = document.querySelector('.add-form-button');
	const nameInputElement = document.querySelector('.add-form-name');
	const nameTextAreaElement = document.querySelector('.add-form-text');
	const myDate = new Date().toLocaleDateString().slice(0, 6) + new Date().toLocaleDateString().slice(-2);
	const nowDate = myDate + ' ' + new Date().toLocaleTimeString().slice(0, -3);

	const listElement = document.getElementById('list');



	const comments = [
		{
			name: 'Глеб Фокин',
			date: '12.02.22 12:18',
			comment: 'Это будет первый комментарий на этой странице',
			like: 3,
			isLiked: false,
		},
		{
			name: 'Варвара Н.',
			date: '13.02.22 19:22',
			comment: 'Мне нравится как оформлена эта страница! ❤',
			like: 75,
			isLiked: true,
		},
	];


	const initEventListeners = () => {
		const buttonElements = document.querySelectorAll('.like-button');

		for (const buttonElement of buttonElements) {
			buttonElement.addEventListener('click', (event) => {
				// тормозим цепочку распростронения событий 
				event.stopPropagation();
				// индекс = номер обьекта в массиве, получаем из дата атрибута кнопки на которую нажимаем
				const index = buttonElement.dataset.index;
				// обращаемся к свойству isLaked обьекта массива, кот мы получили из массива comments по индексу
				if (comments[index].isLiked) {
					comments[index].isLiked = false;
					comments[index].like--;
				} else {
					comments[index].isLiked = true;
					comments[index].like++;
				}

				renderComments();
			});
		}

		// создаю коллекцию коменнтариев
		const answerElements = document.querySelectorAll('.comment-text');

		for (const answer of answerElements) {
			answer.addEventListener('click', (event) => {
				event.stopPropagation();
				const index = answer.dataset.index;

				// вариант без звезды
				nameTextAreaElement.value = `> ${comments[index].comment} \n\n ${comments[index].name}, `;

				// вариант со звездой
				// nameTextAreaElement.value = `QUOTE_BEGIN ${comments[index].comment} QUOTE_END \n\n${comments[index].name}, `;


				// renderComments();
			});
		}
	};

	const renderComments = () => {
		const commentsHtml = comments.map((comment, index) => {
			return `<li class="comment">
					<div class="comment-header">
						<div>${comment.name}</div>
						<div>${comment.date}</div>
					</div>
					<div class="comment-body">
						<div style="white-space:pre-line" class="comment-text" data-index='${index}'>
							${comment.comment}
						</div>
					</div>
					<div class="comment-footer">
						<div class="likes">
							<span class="likes-counter">${comment.like}</span>
							<button class="like-button ${comment.isLiked ? '-active-like' : ''}" data-index='${index}'>
							</button>
						</div >
					</div >
				</li >`;
		}).join('');


		listElement.innerHTML = commentsHtml;

		initEventListeners();

	}

	renderComments();

	const likesElements = document.querySelectorAll('.likes');

	initEventListeners();

	renderComments();

	btnElement.addEventListener('click', () => {

		nameInputElement.classList.remove('error');
		nameTextAreaElement.classList.remove('error');

		if (nameInputElement.value === '') {
			nameInputElement.classList.add('error');
			return;
		}
		if (nameTextAreaElement.value === '') {
			nameTextAreaElement.classList.add('error');
			return;
		}

		// мое первое решение
		// if (nameTextAreaElement.value === '' || nameInputElement.value === '') {
		// 	return;
		// }

		comments.push({
			name: nameInputElement.value.replaceAll("&", "&amp;")
				.replaceAll("<", "&lt;")
				.replaceAll(">", "&gt;")
				.replaceAll('"', "&quot;"),
			date: nowDate,
			comment: nameTextAreaElement.value.replaceAll("&", "&amp;")
				.replaceAll("<", "&lt;")
				.replaceAll(">", "&gt;")
				.replaceAll('"', "&quot;"),
			like: 0,
			isLiked: false,
		});
		renderComments();

		nameInputElement.value = '';
		nameTextAreaElement.value = '';

	});


</script>



</html>

</html>